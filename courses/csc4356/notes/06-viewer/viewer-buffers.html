<!DOCTYPE html>
<html>
<head>
	<title>Interactive Computer Graphics</title>
	<link rel="stylesheet" type="text/css" href="../style.css" />
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://csc.lsu.edu/~kooima/MathJax.js"></script>
	<script type="text/javascript" src="../script.js"></script>
</head>
<body>
	<h1>Buffer Objects</h1>

	<p>Just as we needed to know the locations of the shader uniforms to give them values, we need to know the locations of the shader varyings in order to bind them to vertex buffers.</p>

	<figure class="pseudocode" id="initialization">
		&#x3008;Buffer Initialization&#x3009; &equiv;<br>
	</figure>
	<figure class="pseudocode">
		<table style="margin-left:2em">
			<tr><td><i>vertexPositionLocation</i></td><td>&nbsp;&larr;&nbsp;</td><td><code class="small">gl.getAttribLocation</code>(<code>gl.program</code>, &ldquo;vertexPosition&rdquo;)</code></td></tr>
			<tr><td><i>vertexNormalLocation</i>  </td><td>&nbsp;&larr;&nbsp;</td><td><code class="small">gl.getAttribLocation</code>(<code>gl.program</code>, &ldquo;vertexNormal&rdquo;)</code></td></tr>
		</table>
	</figure>

	<p>To be useful, these attribute locations must be <em>enabled</em>.</p>

	<figure class="pseudocode">
		&emsp;&emsp;<code>gl.enableVertexAttribArray</code>(<i>vertexPositionLocation</i>)</code>
		&emsp;&emsp;<code>gl.enableVertexAttribArray</code>(<i>vertexNormalLocation</i>)</code>
	</figure>

	<p>We have our data in three arrays, <code>vertices</code>, <code>normals</code>, and <code>triangles</code>, but GL doesn't accept data in this form. These must converted to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays">typed arrays</a>.</p>

	<figure class="pseudocode">
		<table style="margin-left:2em">
			<tr><td><i>positionArray</i> </td><td>&nbsp;&larr;&nbsp;<code>new Float32Array</code>(<a href="../01-geometry/geometry-11.html#flatten"><code>flatten</code></a>(<i>vertices</i>))</td></tr>
			<tr><td><i>normalArray</i>   </td><td>&nbsp;&larr;&nbsp;<code>new Float32Array</code>(<a href="../01-geometry/geometry-11.html#flatten"><code>flatten</code></a>(<i>normals</i>))</td></tr>
			<tr><td><i>triangleArray</i> </td><td>&nbsp;&larr;&nbsp;<code>new Uint16Array </code>(<a href="../01-geometry/geometry-11.html#flatten"><code>flatten</code></a>(<i>triangles</i>))</td></tr>
		</table>
	</figure>

	<p>Then, each of these typed arrays is copied to a newly-created vertex buffer object. The vertex positions and normals go into array buffers.</p>

	<figure class="pseudocode">
		&emsp;&emsp;<i>positionBuffer</i> &larr; <code>gl.createBuffer()</code><br>
		&emsp;&emsp;<code class="small">gl.bindBuffer</code>(<code>gl.ARRAY_BUFFER</code>, <i>positionBuffer</i>)<br>
		&emsp;&emsp;<code class="small">gl.bufferData</code>(<code>gl.ARRAY_BUFFER</code>, <i>positionArray</i>, <code>gl.STATIC_DRAW</code>)<br>
	</figure>

	<figure class="pseudocode">
		&emsp;&emsp;<i>normalBuffer</i> &larr; <code>gl.createBuffer()</code><br>
		&emsp;&emsp;<code class="small">gl.bindBuffer</code>(<code>gl.ARRAY_BUFFER</code>, <i>normalBuffer</i>)<br>
		&emsp;&emsp;<code class="small">gl.bufferData</code>(<code>gl.ARRAY_BUFFER</code>, <i>normalArray</i>, <code>gl.STATIC_DRAW</code>)<br>
	</figure>

	<p>The triangles go into an element array buffer.</p>

	<figure class="pseudocode">
		&emsp;&emsp;<i>triangleBuffer</i> &larr; <code>gl.createBuffer()</code><br>
		&emsp;&emsp;<code class="small">gl.bindBuffer</code>(<code>gl.ELEMENT_ARRAY_BUFFER</code>, <i>triangleBuffer</i>)<br>
		&emsp;&emsp;<code class="small">gl.bufferData</code>(<code>gl.ELEMENT_ARRAY_BUFFER</code>, <i>triangleArray</i>, <code>gl.STATIC_DRAW</code>)<br>
	</figure>

	<nav>
		<a id="prev" href="viewer-shaders.html"></a>
		<a id="home" href="../index.html"></a>
		<a id="next" href="viewer-rendering.html"></a>
	</nav>
</body>
</html>
