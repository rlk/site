<!DOCTYPE html>
<html>
<head>
	<title>Interactive Computer Graphics</title>
	<link rel="stylesheet" type="text/css" href="../style.css" />
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://csc.lsu.edu/~kooima/MathJax.js"></script>
	<script type="text/javascript" src="../script.js"></script>
</head>
<body>
	<h1>Rendering</h1>

	<p>The rendering section describes what happens every time a new frame of animation is rendered.</p>

	<p>First, we compose matrices for the persective and model transformations. The textbook's matrix library helps.</p>

	<figure class="pseudocode">
		&#x3008;Rendering&#x3009; &equiv;<br>
		&emsp;&emsp;<b>function</b> draw()<br>

		<table style="margin-left:4em">
			<tr><td><i>projectionMatrix</i></td><td style="text-align:right">&nbsp;&larr;&nbsp;</td><td>persective(<code>45</code>, <code>1</code>, <code>1</code>, <code>10</code>);</td></tr>
			<tr><td><i>modelMatrix</i>     </td><td style="text-align:right">&nbsp;&larr;&nbsp;</td><td>translation(<code>0</code>, <code>0</code>, &minus;<i>modelTranslationZ</i>)</td></tr>
			<tr><td>                       </td><td style="text-align:right">&middot;&nbsp;</td><td>rotation(<i>modelRotationX</i>, <code>1</code>, <code>0</code>, <code>0</code>)</td></tr>
			<tr><td>                       </td><td style="text-align:right">&middot;&nbsp;</td><td>rotation(<i>modelRotationY</i>, <code>0</code>, <code>1</code>, <code>0</code>)</td></tr>
		</table>
	</figure>

	<p>These are delivered to the <a href="viewer-shaders.html">vertex shader</a> via uniforms. Again, the textbook's matrix library gets involved.</p>

	<figure class="pseudocode">
		<table style="margin-left:4em">
			<tr><td><code>gl.uniformMatrix4fv</code></td><td>(<i>projectionMatrixLocation</i>,</td> <td><code>false</code>, <i>projectionMatrix</i>)</td></tr>
			<tr><td><code>gl.uniformMatrix4fv</code></td><td>(<i>modelMatrixLocation</i>,</td>      <td><code>false</code>, <i>     modelMatrix</i>)</td></tr>
		</table>
	</figure>

	<p>We also have the opportunity to specify the parameters of the lighting equation. Here, some simple defaults are given, but these values could easily be given by GUI elements.</p>

	<figure class="pseudocode">
		<table style="margin-left:4em">
			<tr><td><code>gl.uniform3f</code></td><td>(<i>lightDirectionLocation</i>,&nbsp;</td><td><code>0.0</code>, <code>1.0</code>, <code>0.0</code>)</td></tr>
			<tr><td><code>gl.uniform3f</code></td><td>(<i>lightColorLocation</i>,&nbsp;</td>    <td><code>1.0</code>, <code>1.0</code>, <code>1.0</code>)</td></tr>
			<tr><td><code>gl.uniform3f</code></td><td>(<i>objectColorLocation</i>,&nbsp;</td>   <td><code>0.8</code>, <code>0.8</code>, <code>0.8</code>)</td></tr>
		</table>
	</figure>

	<p>Having finished with the uniforms, move on to configure the attributes. Each of the array buffers contains a list of 3-compotent floating point vectors.</p>

	<figure class="pseudocode">
		&emsp;&emsp;&emsp;&emsp;<code class="small">gl.bindBuffer</code>(<code>gl.ARRAY_BUFFER</code>, <i>positionBuffer</i>)<br>
		&emsp;&emsp;&emsp;&emsp;<code class="small">gl.vertexAttribPointer</code>(<i>vertexPositionLocation</i>, <code>3</code>, <code>gl.FLOAT</code>, <code>false</code>, <code>0</code>, <code>0</code>)<br>

		&emsp;&emsp;&emsp;&emsp;<code class="small">gl.bindBuffer</code>(<code>gl.ARRAY_BUFFER</code>, <i>normalBuffer</i>)<br>
		&emsp;&emsp;&emsp;&emsp;<code class="small">gl.vertexAttribPointer</code>(<i>vertexNormalLocation</i>, <code>3</code>, <code>gl.FLOAT</code>, <code>false</code>, <code>0</code>, <code>0</code>)<br>
	</figure>

	<p>With all configuration in place, we can finally render. Begin by clearing the screen, and finish by drawing the contents of the triangle element buffer.</p>

	<figure class="pseudocode">
		&emsp;&emsp;&emsp;&emsp;<code class="small">gl.clear</code>(<code>gl.COLOR_BUFFER_BIT</code> | <code>gl.DEPTH_BUFFER_BIT</code>);</code><br>
		&emsp;&emsp;&emsp;&emsp;<code class="small">gl.bindBuffer</code>(<code>gl.ELEMENT_ARRAY_BUFFER</code>, <i>triangleBuffer</i>)<br>
		&emsp;&emsp;&emsp;&emsp;<code class="small">gl.drawElements</code>(<code>gl.TRIANGLES</code>, <i>triangleArray</i>.<code>length</code>, <code>gl.UNSIGNED_SHORT</code>, <code>0</code>)<br>
	</figure>

	<nav>
		<a id="prev" href="viewer-buffers.html"></a>
		<a id="home" href="../index.html"></a>
		<a id="next" href="viewer-elements.html"></a>
	</nav>
</body>
</html>
